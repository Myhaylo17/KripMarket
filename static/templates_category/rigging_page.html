<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ä–æ–∫ | –î–µ—Ç–∞–ª—ñ –¢–∞–∫–µ–ª–∞–∂—É</title>
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω—É -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –ë–∞–∑–æ–≤—ñ —Å—Ç–∏–ª—ñ —Ç–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; }
        .hidden { display: none !important; }

        /* HEADER —Ç–∞ –ú–ï–ù–Æ (–ñ–æ–≤—Ç–æ-–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤—ñ –∫–æ–ª—å–æ—Ä–∏) */
        header { background-color: #fcd34d; /* Tailwind amber-300 */ }
        .header-content { max-width: 1280px; margin: 0 auto; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .logo a {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .logo a h1 { color: #333; font-size: 2.25rem; font-weight: 700; line-height: 1; }
        .logo-icon { font-size: 2.5rem; color: #f59e0b; }

        /* Product Detail Styles */
        .product-detail-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; max-width: 1000px; margin: 0 auto; }
        @media (min-width: 768px) {
            .product-detail-grid { grid-template-columns: 40% 60%; } /* –ó–±—ñ–ª—å—à–µ–Ω–∞ –ª—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –¥–ª—è —Ñ–æ—Ç–æ */
        }

        .product-main-image {
            font-size: 10rem; /* –í–µ–ª–∏–∫–µ —Ñ–æ—Ç–æ */
            line-height: 1;
            text-align: center;
            padding: 2rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 0 0 2px #f59e0b;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-main-image img {
             width: 100%;
             height: auto;
             max-height: 350px;
             object-fit: contain;
        }

        /* –ü–æ—Å–∏–ª–∞–Ω–Ω—è –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É - –≥—ñ—Ä—á–∏—á–Ω–∏–π –∫–æ–ª—ñ—Ä */
        .back-btn {
            display: inline-flex;
            align-items: center;
            color: #f59e0b;
            transition: color 0.2s;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        .back-btn:hover { color: #d97706; }

        /* Form Styles */
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; }

        .confirm-btn { background-color: #f59e0b; color: white; padding: 1rem 1.5rem; font-size: 1.25rem; font-weight: 700; border-radius: 0.25rem; width: 100%; transition: background-color 0.2s; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); margin-top: 1.5rem; }
        .confirm-btn:hover { background-color: #d97706; }

        /* FOOTER (–ß–æ—Ä–Ω–∏–π/–¢–µ–º–Ω–∏–π –∫–æ–ª—ñ—Ä) */
        footer { background-color: #000; color: white; padding: 2rem 0 1rem; margin-top: auto; }
        .footer-content { max-width: 1280px; margin: 0 auto; padding: 0 1rem; padding-left: 2rem; padding-right: 2rem; }
        .footer-main { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1.5rem; border-bottom: 1px solid #222; }
        .contact-info { display: flex; flex-direction: column; gap: 0.5rem; }
        .contact-item svg { margin-right: 0.5rem; color: #f59e0b; }
        .contact-item a { color: white; text-decoration: none; transition: color 0.2s; }
        .contact-item a:hover { color: #f59e0b; }
        .social-links { display: flex; gap: 1rem; }
        .social-btn { background-color: #f59e0b; color: black; padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 700; text-decoration: none; transition: opacity 0.2s; }
        .social-btn:hover { opacity: 0.8; }
        .footer-bottom { text-align: center; font-size: 0.875rem; color: #aaa; margin-top: 1rem; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Custom Modal Window for Confirmation -->
    <div id="orderModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-2xl max-w-sm w-full text-center">
            <svg id="modalIcon" class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 id="modalTitle" class="text-2xl font-bold mb-3">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!</h3>
            <p id="modalMessage" class="text-gray-700">–í–∞—à—ñ –¥–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (MySQL). –ú–∏ –∑–≤'—è–∂–µ–º–æ—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.</p>
            <button onclick="closeModal()" class="mt-5 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="shadow-lg">
        <div class="header-content">
            <div class="logo">
                <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ì–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É —á–µ—Ä–µ–∑ –∫–æ—Ä–µ–Ω–µ–≤–∏–π —Ä–æ—É—Ç FastAPI (/) -->
                <a href="/" class="flex items-center gap-2">
                    <span class="logo-icon">üî©</span>
                    <h1>–°—Ç–∞—Ä–æ–∫</h1>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content (Product Detail Page) -->
    <main class="p-4 md:p-8 flex-grow">
        <!-- –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ - –≥—ñ—Ä—á–∏—á–Ω–∏–π –∫–æ–ª—ñ—Ä -->
        <a href="#" onclick="history.back(); return false;" class="back-btn">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É
        </a>

        <div class="product-detail-grid">
            <!-- –ë–ª–æ–∫ –∑ —Ñ–æ—Ç–æ -->
            <div class="flex flex-col items-center">
                <div class="product-main-image shadow-lg" id="productMainImage">
                    <p class="text-base text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ...</p>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é —Ç–∞ —Ñ–æ—Ä–º–æ—é -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-2" id="productTitle">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h2>
                <p class="text-5xl font-extrabold text-red-600 mb-6" id="productPrice">–¶—ñ–Ω–∞: 0.00 –≥—Ä–Ω</p>

                <div class="product-description mb-6">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É:</h3>
                    <p id="productDescription" class="text-gray-700"></p>
                </div>

                <!-- –§–û–†–ú–ê –ó–ê–ú–û–í–õ–ï–ù–ù–Ø -->
                <form id="orderForm" onsubmit="handleOrderSubmit(event)">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>

                    <!-- –í–∏–±—ñ—Ä –†–æ–∑–º—ñ—Ä—É (–¶–Ü–ù–ê –ó–ê–õ–ï–ñ–ò–¢–¨ –í–Ü–î –ù–¨–û–ì–û) -->
                    <div class="form-group">
                        <label for="productSize">–†–æ–∑–º—ñ—Ä:</label>
                        <select id="productSize" required onchange="updatePrice()">
                            <!-- –û–ø—Ü—ñ—ó —Ä–æ–∑–º—ñ—Ä—ñ–≤ –±—É–¥—É—Ç—å –≤—Å—Ç–∞–≤–ª–µ–Ω—ñ JS -->
                        </select>
                    </div>

                    <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å -->
                    <div class="form-group">
                        <label for="productQuantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label>
                        <input type="number" id="productQuantity" value="1" min="1" required oninput="updatePrice()">
                    </div>

                    <!-- –ü–Ü–ë -->
                    <div class="form-group">
                        <label for="clientName">–ü–Ü–ë:</label>
                        <input type="text" id="clientName" placeholder="–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á" required>
                    </div>

                    <!-- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É -->
                    <div class="form-group">
                        <label for="clientPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>
                        <input type="tel" id="clientPhone" placeholder="+380 (XX) XXX XX XX" required>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ -->
                    <button type="submit" class="confirm-btn">
                        –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                    </button>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-main">
                <div class="contact-info">
                    <div class="contact-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7  2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <a href="tel:+380679025518">+380679025518</a>
                    </div>
                    <div class="contact-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        <a href="mailto:andreas.zartmet@gmail.com">andreas.zartmet@gmail.com</a>
                    </div>
                </div>
                <div class="social-links">
                    <a href="https://t.me/kripmarket" target="_blank" class="social-btn">TG</a>
                    <a href="viber://chat?number=380123456789" class="social-btn">VB</a>
                </div>
            </div>
            <div class="footer-bottom text-sm mt-2">
                <p>¬© 2025 –ö—Ä—ñ–ø–ú–∞—Ä–∫–µ—Ç. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT –õ–û–ì–Ü–ö–ê -->
    <script>
        let currentProduct = null;

        // API Endpoint –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω—å –¥–æ FastAPI/MySQL
        const API_URL = '/api/orders/';

        // –ú–∞—Å–∏–≤ —É—Å—ñ—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (–¢–∞–∫–µ–ª–∞–∂)
        const allProducts = [
            // –¢–∞–∫–µ–ª–∞–∂ 1: DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ
            {
                id: 1,
                name: '–¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ',
                basePrice: 50.95,
                image: '/static/images/tarlep.jpg',
                description: '–¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ DIN1480. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –Ω–∞—Ç—è–≥—É–≤–∞–Ω–Ω—è –∫–∞–Ω–∞—Ç—ñ–≤, —Ç—Ä–æ—Å—ñ–≤ —Ç–∞ –ª–∞–Ω—Ü—é–≥—ñ–≤.',
                sizes: [
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú10 (—à—Ç)', price: 50.95 },
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú12 (—à—Ç)', price: 74.15 },
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú14 (—à—Ç)', price: 109.92 },
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú16 (—à—Ç)', price: 145.93 },
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú6 (—à—Ç)', price: 30.96 },
                    { name: 'DIN1480 –¢–∞—Ä–ª–µ–ø–∏ –∫–æ–≤–∞–Ω—ñ –≥–∞–∫-–æ–∫–æ –ú8 (—à—Ç)', price: 36.94 },
                ],
                category: 'rigging'
            },
            // –¢–∞–∫–µ–ª–∞–∂ 2: –ö–∞—Ä–∞–±—ñ–Ω U M22
            {
                id: 2,
                name: '–ö–∞—Ä–∞–±—ñ–Ω U M22',
                basePrice: 149.60,
                image: '/static/images/carabin_UM22.png',
                description: '–ö–∞—Ä–∞–±—ñ–Ω U-–ø–æ–¥—ñ–±–Ω–∏–π –ú22.',
                sizes: [
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω U M22 (—à—Ç)', price: 149.60 },
                ],
                category: 'rigging'
            },
            // –¢–∞–∫–µ–ª–∞–∂ 3: –ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂–µ–∂–Ω–∏–π –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞
            {
                id: 3,
                name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂–µ–∂–Ω–∏–π –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞',
                basePrice: 6.25,
                image: '/static/images/carabin_without_fix.jpg',
                description: '–ü–æ–∂–µ–∂–Ω–∏–π –∫–∞—Ä–∞–±—ñ–Ω –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞, –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–∏–π.',
                sizes: [
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 4—Ö40 (—à—Ç)', price: 6.25 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 5—Ö50 (—à—Ç)', price: 6.34 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 6—Ö60 (—à—Ç)', price: 7.35 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 7—Ö70 (—à—Ç)', price: 10.98 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 8—Ö80 (—à—Ç)', price: 13.33 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 9—Ö90 (—à—Ç)', price: 18.92 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 10—Ö100 (—à—Ç)', price: 24.53 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 12—Ö140 (—à—Ç)', price: 51.43 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –±–µ–∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–∞ 14—Ö180 (—à—Ç)', price: 127.68 },
                ],
                category: 'rigging'
            },
            // –¢–∞–∫–µ–ª–∞–∂ 4: –ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂–µ–∂–Ω–∏–π –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º
            {
                id: 4,
                name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂–µ–∂–Ω–∏–π –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º',
                basePrice: 8.72,
                image: '/static/images/carabin_without_fix.jpg',
                description: '–ü–æ–∂–µ–∂–Ω–∏–π –∫–∞—Ä–∞–±—ñ–Ω –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º (–≥–∞–π–∫–æ—é), –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–∏–π.',
                sizes: [
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º 4—Ö40 (—à—Ç)', price: 8.72 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º 5—Ö50 (—à—Ç)', price: 7.85 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º 6—Ö60 (—à—Ç)', price: 10.11 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º 8—Ö80 (—à—Ç)', price: 16.16 },
                    { name: '–ö–∞—Ä–∞–±—ñ–Ω –ø–æ–∂. –∑ —Ñ—ñ–∫—Å–∞—Ç–æ—Ä–æ–º 10—Ö100 (—à—Ç)', price: 25.47 },
                ],
                category: 'rigging'
            },
            // –¢–∞–∫–µ–ª–∞–∂ 5: –õ–∞–Ω—Ü—é–≥
            {
                id: 5,
                name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–∏–π –æ—Ü–∏–Ω–∫–æ–≤–∞–Ω–∏–π',
                basePrice: 11.70,
                image: '/static/images/lancug.jpg',
                description: '–û—Ü–∏–Ω–∫–æ–≤–∞–Ω–∏–π –ª–∞–Ω—Ü—é–≥ –¥–ª—è –≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–∏—Ö –ø–æ—Ç—Ä–µ–±. –¶—ñ–Ω–∞ –≤–∫–∞–∑–∞–Ω–∞ –∑–∞ –º–µ—Ç—Ä.',
                sizes: [
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 2–º–º/111–º (–∑–∞ –º–µ—Ç—Ä)', price: 11.70 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 3–º–º/125–º (–∑–∞ –º–µ—Ç—Ä)', price: 18.38 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 4–º–º/84–º (–∑–∞ –º–µ—Ç—Ä)', price: 30.99 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 4–º–º/84–º (2) (–∑–∞ –º–µ—Ç—Ä)', price: 29.13 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 5–º–º/56–º (–∑–∞ –º–µ—Ç—Ä)', price: 50.26 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 5–º–º/56–º (2) (–∑–∞ –º–µ—Ç—Ä)', price: 47.24 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 6–º–º/36–º (–∑–∞ –º–µ—Ç—Ä)', price: 70.60 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 8–º–º/20–º (–∑–∞ –º–µ—Ç—Ä)', price: 126.42 },
                    { name: '–õ–∞–Ω—Ü—é–≥ –≥–æ—Å–ø. –æ—Ü 8–º–º/20–º (2) (–∑–∞ –º–µ—Ç—Ä)', price: 120.10 },
                ],
                category: 'rigging'
            },
        ];

        /**
         * 1. –û—Ç—Ä–∏–º—É—î ID –ø—Ä–æ–¥—É–∫—Ç—É –∑ URL.
         */
        function getProductIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('id'));

            // –¢—É—Ç –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ ID 1 —è–∫ –∑–∞–≥–ª—É—à–∫—É, —è–∫—â–æ –≤ URL –Ω–µ–º–∞—î ID.
            if (!productId) {
                 console.warn("ID –ø—Ä–æ–¥—É–∫—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ URL. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤–∏–π ID 1.");
                 return 1;
            }
            return productId;
        }

        /**
         * –û–Ω–æ–≤–ª—é—î –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –æ–±—Ä–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ.
         */
        function updatePrice() {
            if (!currentProduct) return;

            const sizeSelect = document.getElementById('productSize');
            const quantityInput = document.getElementById('productQuantity');

            const selectedSizeName = sizeSelect.value;
            const quantity = parseInt(quantityInput.value) || 0;

            const selectedSize = currentProduct.sizes.find(s => s.name === selectedSizeName);
            const priceForSelectedPackage = selectedSize ? selectedSize.price : 0;

            const total = priceForSelectedPackage * quantity;

            document.getElementById('productPrice').textContent = `–¶—ñ–Ω–∞: ${total.toFixed(2)} –≥—Ä–Ω`;
        }

        /**
         * 2. –ó–∞–ø–æ–≤–Ω—é—î —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç—É.
         */
        function loadProductDetails() {
            const productId = getProductIdFromUrl();
            if (!productId) {
                document.getElementById('productTitle').textContent = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ID";
                return;
            }

            currentProduct = allProducts.find(p => p.id === productId);

            if (!currentProduct) {
                document.getElementById('productTitle').textContent = "–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
                return;
            }

            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
            document.getElementById('productTitle').textContent = currentProduct.name;
            document.getElementById('productDescription').textContent = currentProduct.description;

            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            const mainImageContainer = document.getElementById('productMainImage');
            if (currentProduct.image) {
                 const imagePath = currentProduct.image;
                 // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —à–ª—è—Ö
                 const absoluteImagePath = imagePath.startsWith('/') ? imagePath : `/${imagePath}`;

                 mainImageContainer.innerHTML = `<img src="${absoluteImagePath}" alt="${currentProduct.name}" onerror="this.src='/static/img/placeholder.png'; this.onerror=null;">`;
            } else {
                 mainImageContainer.innerHTML = currentProduct.image || 'üî©';
            }

            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –≤–∏–±–æ—Ä—É —Ä–æ–∑–º—ñ—Ä—É
            const sizeSelect = document.getElementById('productSize');
            if (sizeSelect && currentProduct.sizes) {
                sizeSelect.innerHTML = '';

                const uniqueNames = new Set();

                currentProduct.sizes.forEach(size => {
                    const cleanName = size.name.replace(/\s\(\d+\)$/g, '').replace(/\s\(\d+\w+=\d+\s—à—Ç\)/g, '').trim();

                    if (!uniqueNames.has(cleanName)) {
                        uniqueNames.add(cleanName);

                        const option = document.createElement('option');
                        option.value = size.name;
                        option.textContent = cleanName;
                        sizeSelect.appendChild(option);
                    }
                });
            }

            // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Ü—ñ–Ω—É –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—ñ–≤
            updatePrice();
        }

        /**
         * 3. –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–æ MySQL —á–µ—Ä–µ–∑ FastAPI.
         */
        async function handleOrderSubmit(event) {
            event.preventDefault();

            if (!currentProduct) return;

            // –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö —Ñ–æ—Ä–º–∏
            const sizeSelect = document.getElementById('productSize');
            const quantityInput = document.getElementById('productQuantity');
            const nameInput = document.getElementById('clientName');
            const phoneInput = document.getElementById('clientPhone');

            const selectedSizeName = sizeSelect.value;
            const quantity = parseInt(quantityInput.value) || 0;
            const clientName = nameInput.value;
            const clientPhone = phoneInput.value;

            const selectedSize = currentProduct.sizes.find(s => s.name === selectedSizeName);
            const priceForSelectedPackage = selectedSize ? selectedSize.price : 0;

            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ parseFloat –¥–ª—è —Ü—ñ–Ω–∏ —Ç–∞ –æ–∫—Ä—É–≥–ª—é—î–º–æ –¥–æ 2 –∑–Ω–∞–∫—ñ–≤
            const total = parseFloat((priceForSelectedPackage * quantity).toFixed(2));

            if (quantity <= 0) {
                 // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
                 document.getElementById('modalTitle').textContent = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è";
                 document.getElementById('modalMessage').textContent = "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ –Ω—É–ª—è.";
                 document.getElementById('modalIcon').style.color = '#dc3545'; // Red color
                 showModal();
                 return;
            }

            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –¥–∞–Ω–∏—Ö, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î Pydantic —Å—Ö–µ–º—ñ –Ω–∞ FastAPI
            const orderData = {
                'client_name': clientName,
                'client_phone': clientPhone,
                'product_name': currentProduct.name,
                'product_size': selectedSizeName,
                'quantity': quantity,
                'total_price': total, // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ Float
            };

            // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö —É FastAPI
            const success = await sendOrderToBackend(orderData);

            // –û—á–∏—â–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏
            if (success) {
                document.getElementById('orderForm').reset();
            }

            // 4. –ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
            if (success) {
                document.getElementById('modalTitle').textContent = "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!";
                document.getElementById('modalMessage').textContent = "–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.–ú–∏ –∑ –≤–∞–º–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –∑–≤'—è–∂–µ–º–æ—Å—å";
                document.getElementById('modalIcon').style.color = '#10b981'; // Green color
            } else {
                // –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏–π—à–ª–∞, –º–∏ –≤–∂–µ –≤–∏–≤–µ–ª–∏ —ó—ó –≤ –∫–æ–Ω—Å–æ–ª—å, –∞–ª–µ —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
                document.getElementById('modalTitle').textContent = "–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–ù–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ)";
                document.getElementById('modalMessage').textContent = "–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö —É –ë–î. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å FastAPI.";
                document.getElementById('modalIcon').style.color = '#dc3545'; // Red color
            }
            showModal();
        }

        /**
         * –§–∞–∫—Ç–∏—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö –¥–æ FastAPI.
         */
        async function sendOrderToBackend(data) {
             const ORDER_API_ENDPOINT = '/api/orders/';
             console.log("--- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–æ FastAPI API ---");
             console.log(JSON.stringify(data, null, 2));

             try {
                const response = await fetch(ORDER_API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                if (response.ok) {
                    console.log("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ë–î.");
                    return true;
                } else {
                    const errorData = await response.json();
                    console.error(`–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥ FastAPI (Status: ${response.status}):`, errorData);
                    // –î–æ–¥–∞–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–º–∏–ª–∫—É Pydantic
                    if (response.status === 422 && errorData.detail) {
                         console.error("–î–µ—Ç–∞–ª—ñ –ø–æ–º–∏–ª–∫–∏ Pydantic (422):", JSON.stringify(errorData.detail, null, 2));
                    }
                    return false;
                }

             } catch (error) {
                 console.error("–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –¥–æ FastAPI:", error);
                 return false;
             }
        }

        /**
         * –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ–¥–∞–ª—å–Ω–∏–º –≤—ñ–∫–Ω–æ–º.
         */
        function showModal() {
            document.getElementById('orderModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('orderModal').classList.add('hidden');
        }


        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', loadProductDetails);
    </script>
</body>
</html>